$(function() {
	
	$('body').on('click', '.additem', function() {
		var url = $(this).attr('data-url');
		var index = layer.open({
			title: $(this).attr('data-title'),
			type: 2,
			content: url,
			area: ['820px', heiHeght+'px'],
			maxmin: true,
//			end: function() {
//				window.location.reload();
//			}
		});
		layer.full(index);
	});

	$('body').on('click', '.deleteitem', function() {
		var dd = $(this);
		var url = $(this).attr('data-url');
		var id = $(this).attr('id');
		layer.confirm('您确定要删除吗？',{icon:0},function(index){
			$.ajax({
				url: url,
				data: {
					id: id
				},
				success: function(res) {
					layer.msg(res.msg, {
						icon: res.result
					});
					if(res.result===1){
					dd.parents("tr").remove();
					}
				}
			})
		})
	});

	$('body').on('click', '.databack', function() {
		var url = $(this).attr('data-url');
		$.ajax({
			url: url,
			data: $('form').serialize(),
			success: function(res) {
				layer.msg(res.msg);
			}
		})
	});
	$('body').on('click', '.jump', function() {
		var url = $(this).attr('data-url');
		$.ajax({
			url: url,
			//data: $('form').serialize(),
			success: function(res) {				
				layer.msg(res.msg,{icon:res.result},function(){
					if(res.url){
						window.top.location.href=res.url;
					}
				});
			},error:function(index){
				layer.msg('网络错误，请重试！',{icon:2});
			}
		})
	});


	
});
$("#loading-example-btn").click(function() {
	btn = $(this);
	simpleLoad(btn, true);
	simpleLoad(btn, false)
})
//备份表方法
$("#export").click(function() {
	$(this).html("正在发送备份请求...");
	$.post(
		$("#export-form").attr("action"),
		$("#export-form").serialize(),
		function(data) {
			if(data.code == 1) {
				$("#export").html("开始备份，请不要关闭本页面！");
				backup(data.data.tab);
				window.onbeforeunload = function() {
					return "正在备份数据库，请不要关闭！"
				}
			} else {
				layer.tips(data.msg, "#export", {
					tips: [1, '#3595CC'],
					time: 4000
				});
				$("#export").html("立即备份");
			}

		}, "json");
	return false;
});
/*******
 * *
 * 全选
 * 
 * 
 * ******/

function simpleLoad(btn, state) {
	if(state) {
		btn.children().addClass("fa-spin");
		btn.contents().last().replaceWith(" Loading")
	} else {
		setTimeout(function() {
			btn.children().removeClass("fa-spin");
			btn.contents().last().replaceWith(" 刷新")
		}, 2000)
	}
};

//递归备份表
function backup(tab, status) {
	status && showmsg(tab.id, "开始备份...(0%)");
	$.get($("#export-form").attr("action"), tab, function(data) {
		// console.log(data)
		if(data.code == 1) {
			showmsg(tab, data.msg);

			if(!$.isPlainObject(data.data.tab)) {
				$("#export").html("备份完成");
				window.onbeforeunload = function() {
					return null
				}
				return;
			}

			backup(data.data.tab, tab.id != data.data.tab.id);
		} else {
			$("#export").html("立即备份");
		}
	}, "json");

}
//修改备份状态
function showmsg(tab, msg) {
	$("table tbody tr").eq(tab.id).find(".info").html(msg)
}

function $childNode(o) {
	return window.frames[o]
}

function animationHover(o, e) {
	o = $(o), o.hover(function() {
		o.addClass("animated " + e)
	}, function() {
		window.setTimeout(function() {
			o.removeClass("animated " + e)
		}, 2e3)
	})
}

function WinMove() {
	var o = "[class*=col]",
		e = ".ibox-title",
		i = "[class*=col]";
	$(o).sortable({
		handle: e,
		connectWith: i,
		tolerance: "pointer",
		forcePlaceholderSize: !0,
		opacity: .8
	}).disableSelection()
}

	

//鼠标经过显示图片
if(document.getElementById('tipimg')) {
	var tipimg = document.getElementById("tipimg");
	var gg = tipimg.getElementsByTagName("img");
	var ei = document.getElementById("enlarge_images");
	for(i = 0; i < gg.length; i++) {
		var ts = gg[i];
		ts.onmousemove = function(event) {
			event = event || window.event;
			ei.style.display = "block";
			ei.innerHTML = '<img src="' + this.alt + '" height="100"/>';
			ei.style.top = document.body.scrollTop + event.clientY + 10 + "px";
			ei.style.left = document.body.scrollLeft + event.clientX + 10 + "px";

		}
		ts.onmouseout = function() {
			ei.innerHTML = "";
			ei.style.display = "none";

		}
		ts.onclick = function() {
			window.open(this.src);
		}
	}
}

